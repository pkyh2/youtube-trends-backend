// Prisma Schema for YouTube Trends API

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Video {
  video_id      String   @id  // YouTube video ID를 PK로
  title         String
  channel_id    String
  channel_title String
  thumbnail_url String
  view_count    BigInt
  like_count    BigInt
  comment_count BigInt
  published_at  DateTime
  duration      Int      // Duration in seconds
  aspect_ratio  String   // "9:16" for shorts, "16:9" for long-form
  type          String   // "shorts" or "long"
  category_id   String
  category      Category @relation(fields: [category_id], references: [category_id], onDelete: Cascade)
  region_code   String   @default("KR")
  rank          Int      // Rank in trending (1-10)
  is_ad         Boolean  @default(false)

  // Trending tracking fields
  trending_days Int      @default(1)       // 트렌딩에 등장한 횟수 (일 단위)
  first_seen_at DateTime @default(now())   // 트렌딩에 처음 등장한 날짜
  last_seen_at  DateTime @default(now())   // 트렌딩에 마지막으로 등장한 날짜

  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  @@index([type, category_id, region_code, rank])
  @@index([region_code, type, rank])
  @@index([category_id])
  @@index([updated_at])
  @@index([last_seen_at])  // For cleanup queries
  @@index([trending_days, category_id])  // For trend analysis
  @@map("videos")
}

model Category {
  category_id String   @id  // YouTube category ID를 PK로
  name_en     String
  name_ko     String
  videos      Video[]  // Reverse relation
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  @@map("categories")
}